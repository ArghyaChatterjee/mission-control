<ul id=tabs>
	<li onclick='show_tab(this)' class=current>All</li>
	<li onclick='show_tab(this)'>Events</li>
	<li onclick='show_tab(this)'>Sections</li>
</ul>


<section class=tab-section>
	<textarea id=intro data-initial='<%= if session[:intro] then session[:intro].gsub("'", "&apos;") else "# Welcome to the r/SpaceX #{session[:launch]} Official Launch Discussion & Updates Thread!".gsub("'", "&apos;") end %>'></textarea>
	<textarea id=viewing data-initial='<%= if session[:viewing] then session[:viewing].gsub("'", "&apos;") else '### Watching the launch live' end %>'></textarea>
</section>

<section class=tab-events>
	<div class=headers>
		<h3 class=left>
			<i class='fa fa-upload' title='Save to reddit' onclick='saveEvents()'></i>
			### Live Updates
			<i class='fa fa-minus' title='Remove top event' onclick='removeEvent()'></i>
			<i class='fa fa-plus' title='Add event at top' onclick='addEvent()'></i>
		</h3>

		<h3 class=right> <%# the "oh fuck" panel %>
			<a href=# onclick=emergency(this)>RUD</a>
			<a href=# onclick=emergency(this)>Hold</a>
			<a href=# onclick=emergency(this)>Scrub</a>
		</h3>
	</div>

	<ul id=events>
		<%# fetch from server if possible  %>
		<% if session[:events] %>
			<% events = session[:events] %>
			<% if events != nil %>
				<% events.each do |event| %>
					<% event = event[1] %>
					<% if event[1] == '' then next end %>
					<% $message_symbols.each do |k,v| event[1][k] &&= v end %>
					<li class=reverse><i class=sort-icon></i>
						<span onclick='this.setAttribute("data-content", this.getAttribute("data-content") == "Posted" ? "Hidden" : "Posted");' data-content='Posted'></span>
						<span onclick='this.innerHTML = this.innerHTML == "T+" ? "T-" : "T+";'><%= event[0][0..1] %></span><input value='<%= event[0][2..-1].gsub("'", "&apos;") %>' onkeyup='saveIfEnter(event); setSign(this);'>
						Message: <input value='<%= event[1].gsub("'", "&apos;") %>' onkeyup=saveIfEnter(event) onkeydown=_tabEvent(event,this) oninput='hotSwap(this); addEventIfNeeded();'>
				<% end %>
			<% end %>
		<% else %>
		<%# nothing stored on server, give a single blank event %>
			<li class=reverse><i class=sort-icon></i>
				<span onclick='this.setAttribute("data-content", this.getAttribute("data-content") == "Posted" ? "Hidden" : "Posted");' data-content='Posted'></span>
				<span onclick='this.innerHTML = this.innerHTML == "T+" ? "T-" : "T+";'>T+</span><input onkeyup='saveIfEnter(event); setSign(this);'>
				Message: <input onkeyup=saveIfEnter(event) onkeydown=_tabEvent(event,this) oninput='hotSwap(this); addEventIfNeeded();'>
			</li>
		<% end %>
	</ul>
</section>

<section class=tab-section>
	<textarea id=stats data-initial='<%= if session[:stats] then session[:stats].gsub("'", "&apos;") else '### Stats' end %>'></textarea>
	<textarea id=mission data-initial='<%= if session[:mission] then session[:mission].gsub("'", "&apos;") else '### Mission' end %>'></textarea>
	<textarea id=landing data-initial='<%= if session[:landing] then session[:landing].gsub("'", "&apos;") else '### Landing Attempt' end %>'></textarea>
	<textarea id=resources data-initial='<%= if session[:resources] then session[:resources].gsub("'", "&apos;") else '### Resources' end %>'></textarea>
	<textarea id=participate data-initial='<%= if session[:participate] then session[:participate].gsub("'", "&apos;") else '### Participate in the discussion!' end %>'></textarea>
</section>

<template id=event-template>
	<li class=hidden><i class=sort-icon></i>
		<span onclick='this.setAttribute("data-content", this.getAttribute("data-content") == "Posted" ? "Hidden" : "Posted");' data-content='Hidden'></span>
		<span onclick='this.innerHTML = this.innerHTML == "T+" ? "T-" : "T+";'>T+</span><input onkeyup='saveIfEnter(event); setSign(this);'>
		Message: <input onkeyup=saveIfEnter(event) onkeydown=_tabEvent(event,this) oninput='hotSwap(this); addEventIfNeeded();'>
	</li>
</template>
